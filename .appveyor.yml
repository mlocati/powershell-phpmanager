image: Visual Studio 2017

branches:
  only:
    - master

version: "Build {build}"

skip_tags: true

skip_commits:
  files:
    - images/
    - src/
    - .gitignore
    - LICENSE
    - README.md

cache:
  - test\download-cache -> .appveyor.yml
  - '%ProgramFiles%\WindowsPowerShell\Modules\VcRedist -> .appveyor.yml'
  - '%ProgramFiles%\WindowsPowerShell\Modules\PSScriptAnalyzer -> .appveyor.yml'
  - '%ProgramFiles%\WindowsPowerShell\Modules\Pester -> .appveyor.yml'

build: off

install:
  - ps: .\test\setup.ps1

test_script:
  - ps: |
      $pesterResult = .\test\pester.ps1
      $failCount = $pesterResult.FailedCount
      (New-Object 'System.Net.WebClient').UploadFile("https://ci.appveyor.com/api/testresults/nunit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path -LiteralPath .\TestsResults.xml))
      if ($failCount -ne 0) {
        throw "$failCount tests failed!"
      }
